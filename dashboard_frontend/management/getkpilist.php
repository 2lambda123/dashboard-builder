
<?php

include '../config.php';
require '../sso/autoload.php';

use Jumbojett\OpenIDConnectClient;

session_start();
ini_set("max_execution_time", 0);
if (isset($_SESSION['loggedUsername'])) {
    /*     * ************** */
    if (isset($_SESSION['refreshToken'])) {
        $oidc = new OpenIDConnectClient($ssoEndpoint, $ssoClientId, $ssoClientSecret);
        $oidc->providerConfigParam(array('token_endpoint' => $ssoTokenEndpoint));
        $tkn = $oidc->refreshToken($_SESSION['refreshToken']);
        $accessToken = $tkn->access_token;
        $_SESSION['refreshToken'] = $tkn->refresh_token;

        error_reporting(E_ALL);
        //
        $id_mykpi = $_REQUEST['service'];
        if (($id_mykpi !== "") && ($id_mykpi !== null)) {
            $kpi_request = "";
            //$kpi_request = 'https://www.snap4city.org/mypersonaldata/api/v1/public/kpidata/' . $id . '/activities';
            //$kpi_request = '192.168.0.47:8081/test/datamanager/api/v1/kpidata/' . $id_mykpi . '/activities';
            //$id_mykpi = 17055885;
         $kpi_request = $mykpi_api . '/api/v1/kpidata/' . $id_mykpi . '/activities/?last=100&sourceRequestFilter=iotapp';
            //$test = '[{"id":268555277,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-01T21:55:01Z"},{"id":269600227,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-02T21:55:01Z"},{"id":270664235,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-03T21:55:01Z"},{"id":271745332,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-04T21:55:01Z"},{"id":272802258,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-05T21:55:01Z"},{"id":273691677,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-06T18:10:08Z"},{"id":273691749,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-06T18:10:11Z"},{"id":273691839,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-06T18:10:14Z"},{"id":273692027,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-06T18:10:19Z"},{"id":273696285,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-06T18:16:10Z"},{"id":273696311,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-06T18:16:14Z"},{"id":273696337,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-06T18:16:18Z"},{"id":273700423,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-06T18:20:20Z"},{"id":273700452,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-06T18:20:26Z"},{"id":273700498,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-06T18:20:33Z"},{"id":273701454,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-06T18:22:59Z"},{"id":273701477,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-06T18:23:02Z"},{"id":273701515,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-06T18:23:05Z"},{"id":273724465,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-06T18:50:48Z"},{"id":273863281,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-06T21:55:01Z"},{"id":274658789,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T15:58:58Z"},{"id":274658795,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T15:58:59Z"},{"id":274658821,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T15:59:02Z"},{"id":274687165,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T16:35:54Z"},{"id":274687230,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T16:35:58Z"},{"id":274687266,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T16:36:01Z"},{"id":274687414,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T16:36:09Z"},{"id":274687651,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T16:36:17Z"},{"id":274687874,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T16:36:23Z"},{"id":274704883,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T16:58:12Z"},{"id":274714520,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:10:41Z"},{"id":274714839,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:11:06Z"},{"id":274716099,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:12:10Z"},{"id":274716219,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:12:14Z"},{"id":274716771,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:12:38Z"},{"id":274716847,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:12:43Z"},{"id":274718720,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:16:36Z"},{"id":274719722,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:17:23Z"},{"id":274723366,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:22:00Z"},{"id":274723422,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:22:11Z"},{"id":274723514,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:22:26Z"},{"id":274723550,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:22:32Z"},{"id":274724926,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:23:58Z"},{"id":274724970,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:24:06Z"},{"id":274725016,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:24:12Z"},{"id":274727293,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:26:07Z"},{"id":274727358,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:26:14Z"},{"id":274727688,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:26:28Z"},{"id":274727795,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:26:32Z"},{"id":274727980,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:26:45Z"},{"id":274728092,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:26:59Z"},{"id":274733289,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:33:14Z"},{"id":274733400,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:33:18Z"},{"id":274733465,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:33:20Z"},{"id":274740204,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:41:23Z"},{"id":274740391,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:41:52Z"},{"id":274744404,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:46:47Z"},{"id":274744676,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:47:01Z"},{"id":274745153,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:47:24Z"},{"id":274745616,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:48:01Z"},{"id":274745757,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:48:24Z"},{"id":274746235,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:49:33Z"},{"id":274746577,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:50:22Z"},{"id":274750845,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:54:19Z"},{"id":274750855,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:54:21Z"},{"id":274750903,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:54:24Z"},{"id":274750939,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:54:29Z"},{"id":274750961,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T17:54:32Z"},{"id":274756321,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T18:02:05Z"},{"id":274776528,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T18:29:17Z"},{"id":274776620,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T18:29:26Z"},{"id":274776657,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T18:29:34Z"},{"id":274776694,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T18:29:42Z"},{"id":274798083,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T18:57:15Z"},{"id":274798201,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T18:57:29Z"},{"id":274821989,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T19:27:59Z"},{"id":274822035,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T19:28:08Z"},{"id":274822087,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T19:28:16Z"},{"id":274822151,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-07T19:28:23Z"},{"id":274931925,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-07T21:55:01Z"},{"id":275753190,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-08T21:11:49Z"},{"id":275753254,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge3f352de21b550efe88d8b81b83a03f6cbb8c8cdf4d2f2d05eb4fddaa1ab3","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-08T21:12:08Z"},{"id":275778251,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-08T21:55:01Z"},{"id":276557888,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-09T21:55:01Z"},{"id":277361983,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge376bf69bc0d850ecfe9e6fde2b236f30143cdebbd737ceda947c7e719ac7","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-10T19:18:17Z"},{"id":277402880,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge376bf69bc0d850ecfe9e6fde2b236f30143cdebbd737ceda947c7e719ac7","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-10T20:10:35Z"},{"id":277420968,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge376bf69bc0d850ecfe9e6fde2b236f30143cdebbd737ceda947c7e719ac7","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-10T20:54:07Z"},{"id":277433236,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge376bf69bc0d850ecfe9e6fde2b236f30143cdebbd737ceda947c7e719ac7","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-10T21:29:26Z"},{"id":277436094,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge376bf69bc0d850ecfe9e6fde2b236f30143cdebbd737ceda947c7e719ac7","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-10T21:35:15Z"},{"id":277438190,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge376bf69bc0d850ecfe9e6fde2b236f30143cdebbd737ceda947c7e719ac7","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-10T21:41:19Z"},{"id":277439627,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge376bf69bc0d850ecfe9e6fde2b236f30143cdebbd737ceda947c7e719ac7","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-10T21:45:24Z"},{"id":277439665,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge376bf69bc0d850ecfe9e6fde2b236f30143cdebbd737ceda947c7e719ac7","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-10T21:45:29Z"},{"id":277439734,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge376bf69bc0d850ecfe9e6fde2b236f30143cdebbd737ceda947c7e719ac7","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-10T21:45:37Z"},{"id":277443002,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-10T21:55:00Z"},{"id":277450721,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge376bf69bc0d850ecfe9e6fde2b236f30143cdebbd737ceda947c7e719ac7","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-10T22:17:17Z"},{"id":277450728,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge376bf69bc0d850ecfe9e6fde2b236f30143cdebbd737ceda947c7e719ac7","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-10T22:17:18Z"},{"id":277701287,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge376bf69bc0d850ecfe9e6fde2b236f30143cdebbd737ceda947c7e719ac7","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-11T09:04:01Z"},{"id":277701335,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge376bf69bc0d850ecfe9e6fde2b236f30143cdebbd737ceda947c7e719ac7","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-11T09:04:07Z"},{"id":277759565,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge376bf69bc0d850ecfe9e6fde2b236f30143cdebbd737ceda947c7e719ac7","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-11T11:15:13Z"},{"id":277761960,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge376bf69bc0d850ecfe9e6fde2b236f30143cdebbd737ceda947c7e719ac7","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-11T11:20:41Z"},{"id":277761978,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge376bf69bc0d850ecfe9e6fde2b236f30143cdebbd737ceda947c7e719ac7","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-11T11:20:43Z"},{"id":277762050,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge376bf69bc0d850ecfe9e6fde2b236f30143cdebbd737ceda947c7e719ac7","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-11T11:20:50Z"},{"id":277772422,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge376bf69bc0d850ecfe9e6fde2b236f30143cdebbd737ceda947c7e719ac7","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-11T11:41:50Z"},{"id":277772973,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge376bf69bc0d850ecfe9e6fde2b236f30143cdebbd737ceda947c7e719ac7","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-11T11:43:12Z"},{"id":277772993,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge376bf69bc0d850ecfe9e6fde2b236f30143cdebbd737ceda947c7e719ac7","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-11T11:43:14Z"},{"id":277773017,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge376bf69bc0d850ecfe9e6fde2b236f30143cdebbd737ceda947c7e719ac7","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-11T11:43:19Z"},{"id":277778976,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge376bf69bc0d850ecfe9e6fde2b236f30143cdebbd737ceda947c7e719ac7","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-11T11:54:08Z"},{"id":277779071,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge376bf69bc0d850ecfe9e6fde2b236f30143cdebbd737ceda947c7e719ac7","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-11T11:54:12Z"},{"id":277781259,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge376bf69bc0d850ecfe9e6fde2b236f30143cdebbd737ceda947c7e719ac7","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-11T11:56:05Z"},{"id":277787197,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"edge376bf69bc0d850ecfe9e6fde2b236f30143cdebbd737ceda947c7e719ac7","accessType":"WRITE","domain":"VALUE","insertTime":"2020-06-11T12:03:10Z"},{"id":278023839,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-11T21:55:00Z"},{"id":278549017,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-12T21:55:00Z"},{"id":279072399,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-13T21:55:00Z"},{"id":279595164,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-14T21:55:00Z"},{"id":280116695,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-15T21:55:00Z"},{"id":280797711,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-16T21:55:00Z"},{"id":281799641,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-17T21:55:00Z"},{"id":282811440,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-18T21:55:00Z"},{"id":283981954,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-19T21:55:00Z"},{"id":285124326,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-20T21:55:00Z"},{"id":286265075,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-21T21:55:00Z"},{"id":287388193,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-22T21:55:40Z"},{"id":288056947,"username":"nicolaroot","kpiId":17057470,"sourceRequest":"synoptic","sourceId":"126806747","accessType":"READ","domain":"VALUE","insertTime":"2020-06-23T14:10:32Z"},{"id":288090204,"username":"nicolaroot","kpiId":17057470,"sourceRequest":"synoptic","sourceId":"126806747","accessType":"READ","domain":"VALUE","insertTime":"2020-06-23T14:57:34Z"},{"id":288383623,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-23T21:55:00Z"},{"id":289378883,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-24T21:55:00Z"},{"id":290380701,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-25T21:55:09Z"},{"id":290912690,"username":"nicolaroot","kpiId":17057470,"sourceRequest":"synoptic","sourceId":"126806747","accessType":"READ","domain":"VALUE","insertTime":"2020-06-26T10:30:13Z"},{"id":290914775,"username":"nicolaroot","kpiId":17057470,"sourceRequest":"synoptic","sourceId":"126806747","accessType":"READ","domain":"VALUE","insertTime":"2020-06-26T10:33:27Z"},{"id":291437524,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-26T21:55:00Z"},{"id":292592474,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-27T21:55:00Z"},{"id":293754800,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-28T21:55:00Z"},{"id":295030601,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-29T21:55:00Z"},{"id":296376442,"username":"demo_domotica","kpiId":17057470,"sourceRequest":"iotapp","sourceId":"nr35igt","accessType":"READ","domain":"VALUE","insertTime":"2020-06-30T21:55:00Z"}]';
            $authorization = "Authorization: Bearer " . $accessToken; // Prepare the authorisation token
            //$kpi_request = 'https://www.disit.org/test/datamanager/api/v1/kpidata/?sourceRequest';
            //
        //echo($kpi_request);
            $curl = curl_init();
            curl_setopt($curl, CURLOPT_URL, $kpi_request);
            curl_setopt($curl, CURLOPT_HTTPHEADER, array('Content-Type: application/json', $authorization)); // Inject the token into the header
            curl_setopt($curl, CURLOPT_RETURNTRANSFER, true);
            //curl_setopt($curl, CURLOPT_TIMEOUT, 1000);
            $output = curl_exec($curl);
            $httpCode = curl_getinfo($curl, CURLINFO_HTTP_CODE);
            //
            //
        if ($output) {
                if ($httpCode == '200') {
                    //$output = $test;
                    $dec_1 = json_decode($output);
                    //echo($dec_1);
                    $a = count($dec_1);
                    $content = null;
                    $i = 0;
                    if ($a > 0) {
                        $arr = array();
                        foreach ($dec_1 as $row) {
                            $content0 = $row->sourceId;
                            array_push($arr, $content0);
                        }
                        //print_r($arr);
                        $arr01 = array_unique($arr);
                        $content1 = array_values($arr01);

                        $content = $content1;
                        //-->https://iot-app.snap4city.org/nodered/
                        //$content = $dec_1[0]->sourceId;
                        //$content =  $dec_1;
                    } else {
                        $content = null;
                    }
                    //echo($output);
                    //$list_01['dashboards'][0]['dashboardName'] = $output;
                    $list_01['dashboards'][0]['dashboardName'] = $content;
                    $list_01['dashboards'][0]['message'] = $httpCode;
                } else {
                    $list_01['dashboards'][0]['dashboardName'] = null;
                    $list_01['dashboards'][0]['message'] = $httpCode;
                }
            } else {
                //echo 'Curl error: ' . curl_errno($curl);
                $list_01['dashboards'][0]['dashboardName'] = null;
                $list_01['dashboards'][0]['message'] = $httpCode;
                //$list_01['dashboards'][0]['result'] = $_SESSION['accessToken'];
            }
            echo json_encode($list_01);
            curl_close($curl);
        } else {
            $list_01['dashboards'][0]['dashboardName'] = null;
            echo json_encode($list_01);
            //curl_close($curl);
        }
    } else {
        $list_01['dashboards'][0]['dashboardName'] = null;
        echo json_encode($list_01);
        //curl_close($curl);
    }
}
?>